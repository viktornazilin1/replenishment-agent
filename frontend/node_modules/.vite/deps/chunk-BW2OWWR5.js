// node_modules/@ui5/webcomponents-base/dist/util/AccessibilityTextsHelper.js
var associatedElements = /* @__PURE__ */ new WeakMap();
var registeredElements = /* @__PURE__ */ new WeakMap();
var observerOptions = {
  attributes: true,
  childList: true,
  characterData: true,
  subtree: true
};
var getEffectiveAriaLabelText = (el) => {
  const accessibleEl = el;
  if (!accessibleEl.accessibleNameRef) {
    if (accessibleEl.accessibleName) {
      return accessibleEl.accessibleName;
    }
    return void 0;
  }
  return getAllAccessibleNameRefTexts(el);
};
var getAllAccessibleNameRefTexts = (el) => {
  var _a;
  const ids = ((_a = el.accessibleNameRef) == null ? void 0 : _a.split(" ")) ?? [];
  let result = "";
  ids.forEach((elementId, index) => {
    const element = _getReferencedElementById(el, elementId);
    const text = `${element && element.textContent ? element.textContent : ""}`;
    if (text) {
      result += text;
      if (index < ids.length - 1) {
        result += " ";
      }
    }
  });
  return result;
};
var _getAllAssociatedElementsFromDOM = (el) => {
  const set = /* @__PURE__ */ new Set();
  const labelsForAssociated = _getAssociatedLabels(el);
  labelsForAssociated.forEach((itm) => {
    set.add(itm);
  });
  const ariaLabelledBy = el["accessibleNameRef"];
  const ariaDescribedBy = el["accessibleDescriptionRef"];
  const value = [ariaLabelledBy, ariaDescribedBy].filter(Boolean).join(" ");
  const ids = value ? value.split(" ") : [];
  ids.forEach((id) => {
    const refEl = _getReferencedElementById(el, id);
    if (refEl) {
      set.add(refEl);
    }
  });
  return Array.from(set);
};
var _getAssociatedLabels = (el) => {
  const labels = el.getRootNode().querySelectorAll(`[for="${el.id}"]`);
  return Array.from(labels);
};
var _getReferencedElementById = (el, elementId) => {
  return el.getRootNode().querySelector(`[id='${elementId}']`) || document.getElementById(elementId);
};
var _createInvalidationCallback = (el) => {
  const invalidationCallback = (changeInfo) => {
    const isAccessibleNameRefChange = changeInfo && changeInfo.type === "property" && changeInfo.name === "accessibleNameRef";
    const isAccessibleDescriptionRefChange = changeInfo && changeInfo.type === "property" && changeInfo.name === "accessibleDescriptionRef";
    if (!isAccessibleNameRefChange && !isAccessibleDescriptionRefChange) {
      return;
    }
    const registeredElement = registeredElements.get(el);
    if (!registeredElement) {
      return;
    }
    const oldAssociatedElements = registeredElement.observedElements;
    const newAssociatedElements = _getAllAssociatedElementsFromDOM(el);
    oldAssociatedElements.forEach((oldElement) => {
      if (!newAssociatedElements.includes(oldElement)) {
        _removeObservedElementFromRegisteredElement(registeredElement, oldElement);
      }
    });
    newAssociatedElements.forEach((newElement) => {
      if (!oldAssociatedElements.includes(newElement)) {
        _addObservedElementToRegisteredElement(registeredElement, newElement);
        registeredElement.observedElements.push(newElement);
      }
    });
    registeredElement == null ? void 0 : registeredElement.callback();
  };
  return invalidationCallback;
};
var registerUI5Element = (el, callback) => {
  if (registeredElements.has(el)) {
    return;
  }
  const allAssociatedElements = _getAllAssociatedElementsFromDOM(el);
  const invalidationCallback = _createInvalidationCallback(el);
  const registeredElement = {
    host: el,
    observedElements: allAssociatedElements,
    callback,
    invalidationCallback
  };
  registeredElements.set(el, registeredElement);
  el.attachInvalidate(invalidationCallback);
  allAssociatedElements.forEach((element) => {
    _addObservedElementToRegisteredElement(registeredElement, element);
  });
  callback();
};
var _addObservedElementToRegisteredElement = (registeredElement, element) => {
  let associatedElement = associatedElements.get(element);
  if (!associatedElement) {
    associatedElement = { observer: null, callbacks: [] };
    const observer = new MutationObserver(() => {
      const callbacks = associatedElement.callbacks;
      callbacks.forEach((callback) => {
        callback();
      });
      const domEl = document.getElementById(element.id);
      if (!(registeredElement.host.id === element.getAttribute("for") || domEl)) {
        _removeObservedElementFromRegisteredElement(registeredElement, element);
      }
    });
    associatedElement.observer = observer;
    observer.observe(element, observerOptions);
    associatedElements.set(element, associatedElement);
  }
  if (!associatedElement.callbacks.includes(registeredElement.callback)) {
    associatedElement.callbacks.push(registeredElement.callback);
  }
};
var _removeObservedElementFromRegisteredElement = (registeredElement, element) => {
  var _a;
  const associatedElement = associatedElements.get(element);
  if (associatedElement) {
    associatedElement.callbacks = associatedElement.callbacks.filter((itm) => itm !== registeredElement.callback);
    if (!associatedElement.callbacks.length) {
      (_a = associatedElement.observer) == null ? void 0 : _a.disconnect();
      associatedElements.delete(element);
    }
  }
  registeredElement.observedElements = registeredElement.observedElements.filter((itm) => itm !== element);
};
var deregisterUI5Element = (el) => {
  const registeredElement = registeredElements.get(el);
  if (!registeredElement) {
    return;
  }
  const oldObservedElements = [...registeredElement.observedElements];
  oldObservedElements.forEach((observedElement) => {
    _removeObservedElementFromRegisteredElement(registeredElement, observedElement);
  });
  el.detachInvalidate(registeredElement.invalidationCallback);
  registeredElements.delete(el);
};
var getEffectiveAriaDescriptionText = (el) => {
  const accessibleEl = el;
  if (!accessibleEl.accessibleDescriptionRef) {
    if (accessibleEl.accessibleDescription) {
      return accessibleEl.accessibleDescription;
    }
    return void 0;
  }
  return getAllAccessibleDescriptionRefTexts(el);
};
var getAllAccessibleDescriptionRefTexts = (el) => {
  var _a;
  const ids = ((_a = el.accessibleDescriptionRef) == null ? void 0 : _a.split(" ")) ?? [];
  let result = "";
  ids.forEach((elementId, index) => {
    const element = _getReferencedElementById(el, elementId);
    const text = `${element && element.textContent ? element.textContent : ""}`;
    if (text) {
      result += text;
      if (index < ids.length - 1) {
        result += " ";
      }
    }
  });
  return result;
};

export {
  getEffectiveAriaLabelText,
  getAllAccessibleNameRefTexts,
  registerUI5Element,
  deregisterUI5Element,
  getEffectiveAriaDescriptionText,
  getAllAccessibleDescriptionRefTexts
};
//# sourceMappingURL=chunk-BW2OWWR5.js.map
